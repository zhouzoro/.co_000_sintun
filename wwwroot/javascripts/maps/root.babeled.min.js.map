{"version":3,"sources":["root.babeled.min.js","root.babeled.js"],"names":["uploadImg","editorId","tempImgInput","$","attr","type","class","css","display","position","change","this","files","reader","FileReader","onload","e","tinymce","get","insertContent","target","result","uploadImages","readAsDataURL","remove","append","click","login","form","xhr","XMLHttpRequest","open","res","JSON","parse","responseText","status","showTipMsg","msg","find","hide","html","accordion","tab","each","initMce","formData","FormData","send","updatePage","formSelector","$form","activeEditor","success","window","location","url","contentHtml","save","val","console","log","updatePass","uploadPost","deleteNews","nid","$item","setTimeout","undoDelete","show","updatePost","formId","Cookies","txt","isok","color","text","background","border","selector","docId","init","skin","language","content_css","body_class","plugins","toolbar","image_caption","paste_data_images","fontsize_formats","menubar","relative_urls","images_upload_url","statusbar","min_height","max_height","setup","ed","on","setContent","host","background-size","lastIndexOf","uploadPic","img","next","loader","label","removeClass","addClass","updateProgress","oEvent","pct","Math","ceil","loaded","total","height","fileUploadReq","withCredentials","json","upload","addEventListener","name","computProgress","percentComplete","GetCurrentDate","cdate","Date","month","getMonth","currentDate","getFullYear","getDate","document","ready","transloader","targetUrl","data","uploadType","initUploadOf"],"mappings":"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","file":"root.babeled.min.js","sourcesContent":["'use strict';\n\n$(document).ready(function () {\n    $('.ui.accordion').accordion();\n    $('.ui.menu .item').tab();\n});\n\nfunction uploadImg(editorId) {\n    var tempImgInput = $('<input>').attr({\n        'type': 'file',\n        'class': 'temp-input'\n    }).css({\n        'display': 'none',\n        'position': 'absolute'\n    }).change(function () {\n        if (this.files && this.files[0]) {\n            var reader = new FileReader();\n            reader.onload = function (e) {\n                tinymce.get(editorId).insertContent('<img class=\"inline-img\" src=\"' + e.target.result + '\" width=\"100%\" >');\n\n                tinymce.get(editorId).uploadImages();\n            };\n            reader.readAsDataURL(this.files[0]);\n        }\n\n        $('.temp-input').remove();\n    });\n    $('body').append(tempImgInput);\n    tempImgInput.click();\n}\n\nfunction login() {\n    var form = $('form#login');\n    var xhr = new XMLHttpRequest();\n    xhr.open(form.attr('method'), form.attr('action'));\n\n    xhr.onload = function () {\n        var res = JSON.parse(xhr.responseText);\n        if (res.status == '504') {\n            showTipMsg('登录失败: ' + res.msg, 0);\n        } else {\n            showTipMsg('登录成功: ' + res.msg, 1);\n            $('.main').find('.login-page').hide();\n            $('.main').append(res.html);\n\n            $('.ui.accordion').accordion();\n            $('.ui.menu .item').tab();\n            $('.frm-body .input-body').each(function () {\n                initMce('#' + $(this).attr('id'));\n            });\n        }\n    };\n    var formData = new FormData(form[0]);\n    xhr.send(formData);\n}\n\nfunction updatePage(formSelector) {\n    var $form = $(formSelector);\n    tinymce.activeEditor.uploadImages(function (success) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('POST', '/pages');\n\n        xhr.onload = function () {\n            var res = JSON.parse(xhr.responseText);\n            if (res.status == '200') {\n                window.location = res.url;\n            } else if (res.status == '504') {\n                showTipMsg('更新失败: ' + res.msg, 0);\n            }\n        };\n\n        var contentHtml = tinymce.activeEditor.save();\n        $form.find('input[name=content]').val(contentHtml);\n        var formData = new FormData($form[0]);\n        console.log(contentHtml);\n        xhr.send(formData);\n    });\n}\n\nfunction updatePass() {\n    var $form = $('#frm-secu');\n    var xhr = new XMLHttpRequest();\n    xhr.open('POST', '/update_pass');\n\n    xhr.onload = function () {\n        var res = JSON.parse(xhr.responseText);\n        if (res.status == '200') {\n            window.location = res.url;\n        } else if (res.status == '504') {\n            showTipMsg('更新失败: ' + res.msg, 0);\n        }\n    };\n    var formData = new FormData($form[0]);\n    xhr.send(formData);\n}\n\nfunction uploadPost(formSelector) {\n    var $form = $(formSelector);\n\n    tinymce.activeEditor.uploadImages(function (success) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('POST', '/news');\n\n        xhr.onload = function () {\n            var res = JSON.parse(xhr.responseText);\n            if (res.status == '200') {\n                window.location = res.url;\n            } else if (res.status == '504') {\n                showTipMsg('上传失败: ' + res.msg, 0);\n            }\n        };\n\n        var contentHtml = tinymce.activeEditor.save();\n        $form.find('input[name=content]').val(contentHtml);\n        var formData = new FormData($form[0]);\n        xhr.send(formData);\n    });\n}\n\nfunction deleteNews(nid) {\n    var $item = $('#it' + nid);\n    $item.find('*').hide();\n    $item.append('<a class=\"revoke-delete button ui basic gray small\" onclick=\"undoDelete(' + nid + ')\"><i class=\"fa fa-undo\"></i>取消</a><span class=\"revoke-delete date\">已删除</span>');\n    window.setTimeout(function () {\n        if ($item.find(\".revoke-delete\")[0]) {\n            $item.remove();\n            var form = $('form#login');\n            var xhr = new XMLHttpRequest();\n            xhr.open(form.attr('method'), '/delete_news/' + nid);\n\n            var formData = new FormData(form[0]);\n            xhr.send(formData);\n        }\n    }, 4000);\n}\n\nfunction undoDelete(nid) {\n    var $item = $('#it' + nid);\n    $item.find(\".revoke-delete\").remove();\n    $item.find('*').show();\n}\n\nfunction updatePost(formId) {\n    tinymce.activeEditor.uploadImages(function (success) {\n        var form = $(formId);\n        var xhr = new XMLHttpRequest();\n        xhr.open(form.attr('method'), form.attr('action'));\n\n        xhr.onload = function () {\n            console.log(xhr.responseText);\n            var res = JSON.parse(xhr.responseText);\n            if (res.status == '200') {\n                window.location = res.url;\n            } else if (res.status == '504') {\n                showTipMsg('上传失败: ' + res.msg, 0);\n            }\n        };\n        var contentHtml = tinymce.activeEditor.save();\n        $('input[name=content]').val(contentHtml);\n        var formData = new FormData(form[0]);\n        formData.append('username', Cookies.get('username'));\n        formData.append('email', Cookies.get('email'));\n        xhr.send(formData);\n    });\n}\n\nfunction showTipMsg(txt, isok) {\n    var color = isok ? 'green' : 'red';\n    $('p.tip-message').text(txt).css({\n        'background': isok ? 'rgba(55,222,88,0.3)' : 'rgba(222,55,88,0.3)',\n        'color': color,\n        'border': '1px solid ' + color\n    });\n}\n\nfunction initMce(selector, docId) {\n    var inline = docId ? true : false;\n    tinymce.init({\n        selector: selector,\n        skin: 'mxc1',\n        language: 'zh_CN',\n        content_css: '/stylesheets/dist/travelogue.min.css',\n        body_class: 'travelogue',\n        //inline: inline,\n        plugins: [\"autoresize\", \"advlist\", \"autolink\", \"lists\", \"link\", \"image\", \"charmap\", \"print\", \"preview\", \"anchor\", \"searchreplace\", \"visualblocks\", \"code\", \"fullscreen\", \"insertdatetime\", \"media\", \"table\", \"paste\", \"imagetools\"],\n        toolbar: 'undo redo styleselect fontsizeselect bold italic underline alignleft aligncenter alignright alignfull advlist lists link',\n        image_caption: true,\n        paste_data_images: true,\n        //block_formats: 'Paragraph=p;Header 1=h1;Header 2=h2;Header 3=h3',\n        fontsize_formats: '8pt 9pt 10pt 11pt 12pt 14pt 18pt 24pt',\n        //plugins: \"contextmenu\",\n        //contextmenu: \"formatselect bold italic link image inserttable | cell row column deletetable\",\n        menubar: false,\n        relative_urls: false,\n        images_upload_url: '/upload/images',\n        statusbar: false,\n        min_height: 480,\n        max_height: 640,\n\n        setup: function setup(ed) {\n            ed.on('change', function (e) {\n                var contentHtml = ed.save();\n                $('input[name=content]').val(contentHtml).change();\n            });\n            ed.on('init', function (e) {\n\n                if ($('input[name=content]').val()) {\n                    tinymce.activeEditor.setContent($('input[name=content]').val());\n                }\n\n                if ($('input[name=cover]').val()) {\n                    $('.post-hero').css({ 'background': 'url(\"http://' + window.location.host + $('input[name=cover]').val() + '\")', 'background-size': 'cover' });\n                }\n                if (!window.location.host.lastIndexOf('edit')) {}\n            });\n        }\n    });\n}\n\n$('.add-btn').click(function () {\n    var transloader = $('<div>').attr('class', 'expand-transition');\n    $(this).append(transloader);\n    var targetUrl = $(this).data('url');\n    var uploadType = $(this).data('type');\n    $.get(targetUrl, function (res) {\n        $('#modal-cust').find('.container').html(res);\n        $('#btn-cancel').click(function () {\n            $('#body').show();\n            $('#modal-cust').hide('fast');\n            $('#modal-cust').find('.container').html('');\n        });\n        $('#modal-cust').show('slow');\n        $('#body').hide('slow');\n        initUploadOf(uploadType);\n        transloader.remove();\n        $('#edit-pic').click(uploadPic);\n    });\n});\n\nfunction uploadPic() {\n    var img = $(this).next('img');\n    var loader = $(this).find('#pic-loader');\n    var label = $(this).find('label');\n    var tempImgInput = $('<input>').attr({\n        'type': 'file',\n        'class': 'temp-input'\n    }).css({\n        'display': 'none',\n        'position': 'absolute'\n    }).change(function () {\n        if (this.files && this.files[0]) {\n            var reader = new FileReader();\n            reader.onload = function (e) {\n                img.attr('src', e.target.result);\n            };\n            reader.readAsDataURL(this.files[0]);\n            label.removeClass('btn').addClass('pct');\n            var updateProgress = function updateProgress(oEvent) {\n                var pct = Math.ceil(100 * oEvent.loaded / oEvent.total);\n                var height = 100 - pct;\n                loader.css({ 'height': height + 'px' });\n                label.text(pct + '%');\n            };\n            var fileUploadReq = new XMLHttpRequest();\n            fileUploadReq.withCredentials = false;\n            fileUploadReq.open('POST', '/images');\n\n            fileUploadReq.onload = function () {\n                var json = JSON.parse(fileUploadReq.responseText);\n                console.log(json.location);\n                img.attr('src', json.location);\n                label.removeClass('pct').addClass('btn').text('change');\n                $('.temp-input').remove();\n            };\n            fileUploadReq.upload.addEventListener(\"progress\", updateProgress, false);\n            var formData = new FormData();\n            formData.append('image', this.files[0], this.files[0].name);\n            fileUploadReq.send(formData);\n        }\n    });\n    $('body').append(tempImgInput);\n    tempImgInput.click();\n}\n\nfunction computProgress(oEvent) {\n    var percentComplete = Math.ceil(1000 * oEvent.loaded / oEvent.total) / 10 + '%';\n    return percentComplete;\n}\n\nfunction GetCurrentDate() {\n    var cdate = new Date();\n    var month = cdate.getMonth() < 9 ? '0' + (cdate.getMonth() + 1) : cdate.getMonth() + 1;\n    var currentDate = cdate.getFullYear() + \"-\" + month + \"-\" + cdate.getDate();\n    return currentDate;\n}","$(document).ready(() => {\r\n    $('.ui.accordion').accordion();\r\n    $('.ui.menu .item').tab();\r\n});\r\n\r\nfunction uploadImg(editorId) {\r\n    var tempImgInput = $('<input>').attr({\r\n        'type': 'file',\r\n        'class': 'temp-input'\r\n    }).css({\r\n        'display': 'none',\r\n        'position': 'absolute'\r\n    }).change(function() {\r\n        if (this.files && this.files[0]) {\r\n            var reader = new FileReader();\r\n            reader.onload = function(e) {\r\n                tinymce.get(editorId).insertContent('<img class=\"inline-img\" src=\"' + e.target.result + '\" width=\"100%\" >');\r\n\r\n                tinymce.get(editorId).uploadImages();\r\n            };\r\n            reader.readAsDataURL(this.files[0]);\r\n        }\r\n\r\n        $('.temp-input').remove();\r\n    });\r\n    $('body').append(tempImgInput);\r\n    tempImgInput.click();\r\n}\r\n\r\nfunction login() {\r\n    var form = $('form#login');\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open(form.attr('method'), form.attr('action'));\r\n\r\n    xhr.onload = function() {\r\n        var res = JSON.parse(xhr.responseText);\r\n        if (res.status == '504') {\r\n            showTipMsg('登录失败: ' + res.msg, 0);\r\n        } else {\r\n            showTipMsg('登录成功: ' + res.msg, 1);\r\n            $('.main').find('.login-page').hide();\r\n            $('.main').append(res.html);\r\n\r\n            $('.ui.accordion').accordion();\r\n            $('.ui.menu .item').tab();\r\n            $('.frm-body .input-body').each(function() {\r\n                initMce('#' + $(this).attr('id'));\r\n            })\r\n        }\r\n    };\r\n    var formData = new FormData(form[0]);\r\n    xhr.send(formData);\r\n}\r\n\r\nfunction updatePage(formSelector) {\r\n    var $form = $(formSelector);\r\n    tinymce.activeEditor.uploadImages(function(success) {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open('POST', '/pages');\r\n\r\n        xhr.onload = function() {\r\n            var res = JSON.parse(xhr.responseText);\r\n            if (res.status == '200') {\r\n                window.location = res.url;\r\n            } else if (res.status == '504') {\r\n                showTipMsg('更新失败: ' + res.msg, 0);\r\n            }\r\n        };\r\n\r\n        var contentHtml = tinymce.activeEditor.save();\r\n        $form.find('input[name=content]').val(contentHtml);\r\n        var formData = new FormData($form[0]);\r\n        console.log(contentHtml);\r\n        xhr.send(formData);\r\n    });\r\n}\r\n\r\nfunction updatePass() {\r\n    var $form = $('#frm-secu');\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open('POST', '/update_pass');\r\n\r\n    xhr.onload = function() {\r\n        var res = JSON.parse(xhr.responseText);\r\n        if (res.status == '200') {\r\n            window.location = res.url;\r\n        } else if (res.status == '504') {\r\n            showTipMsg('更新失败: ' + res.msg, 0);\r\n        }\r\n    };\r\n    var formData = new FormData($form[0]);\r\n    xhr.send(formData);\r\n}\r\n\r\nfunction uploadPost(formSelector) {\r\n    var $form = $(formSelector);\r\n\r\n    tinymce.activeEditor.uploadImages(function(success) {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open('POST', '/news');\r\n\r\n        xhr.onload = function() {\r\n            var res = JSON.parse(xhr.responseText);\r\n            if (res.status == '200') {\r\n                window.location = res.url;\r\n            } else if (res.status == '504') {\r\n                showTipMsg('上传失败: ' + res.msg, 0);\r\n            }\r\n        };\r\n\r\n        var contentHtml = tinymce.activeEditor.save();\r\n        $form.find('input[name=content]').val(contentHtml);\r\n        var formData = new FormData($form[0]);\r\n        xhr.send(formData);\r\n    });\r\n}\r\n\r\nfunction deleteNews(nid) {\r\n    var $item = $('#it' + nid);\r\n    $item.find('*').hide();\r\n    $item.append('<a class=\"revoke-delete button ui basic gray small\" onclick=\"undoDelete(' + nid + ')\"><i class=\"fa fa-undo\"></i>取消</a><span class=\"revoke-delete date\">已删除</span>');\r\n    window.setTimeout(function() {\r\n        if ($item.find(\".revoke-delete\")[0]) {\r\n            $item.remove();\r\n            var form = $('form#login');\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.open(form.attr('method'), '/delete_news/' + nid);\r\n\r\n            var formData = new FormData(form[0]);\r\n            xhr.send(formData);\r\n        }\r\n    }, 4000)\r\n}\r\n\r\nfunction undoDelete(nid) {\r\n    var $item = $('#it' + nid);\r\n    $item.find(\".revoke-delete\").remove();\r\n    $item.find('*').show();\r\n}\r\n\r\nfunction updatePost(formId) {\r\n    tinymce.activeEditor.uploadImages(function(success) {\r\n        var form = $(formId);\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(form.attr('method'), form.attr('action'));\r\n\r\n        xhr.onload = function() {\r\n            console.log(xhr.responseText);\r\n            var res = JSON.parse(xhr.responseText);\r\n            if (res.status == '200') {\r\n                window.location = res.url;\r\n            } else if (res.status == '504') {\r\n                showTipMsg('上传失败: ' + res.msg, 0);\r\n            }\r\n        };\r\n        var contentHtml = tinymce.activeEditor.save();\r\n        $('input[name=content]').val(contentHtml);\r\n        var formData = new FormData(form[0]);\r\n        formData.append('username', Cookies.get('username'));\r\n        formData.append('email', Cookies.get('email'));\r\n        xhr.send(formData);\r\n    });\r\n}\r\n\r\nfunction showTipMsg(txt, isok) {\r\n    var color = isok ? 'green' : 'red';\r\n    $('p.tip-message').text(txt).css({\r\n        'background': isok ? 'rgba(55,222,88,0.3)' : 'rgba(222,55,88,0.3)',\r\n        'color': color,\r\n        'border': '1px solid ' + color\r\n    });\r\n}\r\n\r\nfunction initMce(selector, docId) {\r\n    var inline = docId ? true : false;\r\n    tinymce.init({\r\n        selector: selector,\r\n        skin: 'mxc1',\r\n        language: 'zh_CN',\r\n        content_css: '/stylesheets/dist/travelogue.min.css',\r\n        body_class: 'travelogue',\r\n        //inline: inline,\r\n        plugins: [\"autoresize\", \"advlist\", \"autolink\", \"lists\", \"link\", \"image\", \"charmap\", \"print\", \"preview\", \"anchor\", \"searchreplace\", \"visualblocks\", \"code\", \"fullscreen\", \"insertdatetime\", \"media\", \"table\", \"paste\", \"imagetools\"],\r\n        toolbar: 'undo redo styleselect fontsizeselect bold italic underline alignleft aligncenter alignright alignfull advlist lists link',\r\n        image_caption: true,\r\n        paste_data_images: true,\r\n        //block_formats: 'Paragraph=p;Header 1=h1;Header 2=h2;Header 3=h3',\r\n        fontsize_formats: '8pt 9pt 10pt 11pt 12pt 14pt 18pt 24pt',\r\n        //plugins: \"contextmenu\",\r\n        //contextmenu: \"formatselect bold italic link image inserttable | cell row column deletetable\",\r\n        menubar: false,\r\n        relative_urls: false,\r\n        images_upload_url: '/upload/images',\r\n        statusbar: false,\r\n        min_height: 480,\r\n        max_height: 640,\r\n\r\n        setup: function(ed) {\r\n            ed.on('change', function(e) {\r\n                var contentHtml = ed.save();\r\n                $('input[name=content]').val(contentHtml).change();\r\n            });\r\n            ed.on('init', function(e) {\r\n\r\n                if ($('input[name=content]').val()) {\r\n                    tinymce.activeEditor.setContent($('input[name=content]').val());\r\n                }\r\n\r\n                if ($('input[name=cover]').val()) {\r\n                    $('.post-hero').css({ 'background': 'url(\"http://' + window.location.host + $('input[name=cover]').val() + '\")', 'background-size': 'cover' });\r\n                }\r\n                if (!window.location.host.lastIndexOf('edit')) {}\r\n\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n$('.add-btn').click(function() {\r\n    var transloader = $('<div>').attr('class', 'expand-transition');\r\n    $(this).append(transloader);\r\n    var targetUrl = $(this).data('url');\r\n    var uploadType = $(this).data('type');\r\n    $.get(targetUrl, function(res) {\r\n        $('#modal-cust').find('.container').html(res);\r\n        $('#btn-cancel').click(function() {\r\n            $('#body').show();\r\n            $('#modal-cust').hide('fast');\r\n            $('#modal-cust').find('.container').html('');\r\n        });\r\n        $('#modal-cust').show('slow');\r\n        $('#body').hide('slow');\r\n        initUploadOf(uploadType);\r\n        transloader.remove();\r\n        $('#edit-pic').click(uploadPic);\r\n    });\r\n});\r\n\r\nfunction uploadPic() {\r\n    var img = $(this).next('img');\r\n    var loader = $(this).find('#pic-loader');\r\n    var label = $(this).find('label');\r\n    var tempImgInput = $('<input>').attr({\r\n        'type': 'file',\r\n        'class': 'temp-input'\r\n    }).css({\r\n        'display': 'none',\r\n        'position': 'absolute'\r\n    }).change(function() {\r\n        if (this.files && this.files[0]) {\r\n            var reader = new FileReader();\r\n            reader.onload = function(e) {\r\n                img.attr('src', e.target.result);\r\n            };\r\n            reader.readAsDataURL(this.files[0]);\r\n            label.removeClass('btn').addClass('pct');\r\n            var updateProgress = function updateProgress(oEvent) {\r\n                var pct = Math.ceil(100 * oEvent.loaded / oEvent.total);\r\n                var height = 100 - pct;\r\n                loader.css({ 'height': height + 'px' });\r\n                label.text(pct + '%');\r\n            };\r\n            var fileUploadReq = new XMLHttpRequest();\r\n            fileUploadReq.withCredentials = false;\r\n            fileUploadReq.open('POST', '/images');\r\n\r\n            fileUploadReq.onload = function() {\r\n                var json = JSON.parse(fileUploadReq.responseText);\r\n                console.log(json.location);\r\n                img.attr('src', json.location);\r\n                label.removeClass('pct').addClass('btn').text('change');\r\n                $('.temp-input').remove();\r\n            };\r\n            fileUploadReq.upload.addEventListener(\"progress\", updateProgress, false);\r\n            var formData = new FormData();\r\n            formData.append('image', this.files[0], this.files[0].name);\r\n            fileUploadReq.send(formData);\r\n        }\r\n    });\r\n    $('body').append(tempImgInput);\r\n    tempImgInput.click();\r\n}\r\n\r\n\r\nfunction computProgress(oEvent) {\r\n    var percentComplete = Math.ceil(1000 * oEvent.loaded / oEvent.total) / 10 + '%';\r\n    return percentComplete;\r\n}\r\n\r\nfunction GetCurrentDate() {\r\n    var cdate = new Date();\r\n    var month = cdate.getMonth() < 9 ? '0' + (cdate.getMonth() + 1) : cdate.getMonth() + 1;\r\n    var currentDate = cdate.getFullYear() + \"-\" + month + \"-\" + cdate.getDate();\r\n    return currentDate;\r\n}\r\n"],"sourceRoot":"/source/"}