{"version":3,"sources":["root.babeled.min.js","root.babeled.js"],"names":["login","formData","FormData","$","xhr","send","updatePage","el","$form","data","tinymce","activeEditor","uploadImages","success","XMLHttpRequest","open","onload","res","JSON","parse","responseText","status","showTipMsg","find","msg","contentHtml","save","append","uploadPost","formSelector","window","location","url","val","updatePost","formId","form","attr","console","log","Cookies","get","initMce","selector","docId","init","skin","language","content_css","body_class","plugins","toolbar","image_caption","paste_data_images","fontsize_formats","menubar","images_upload_url","statusbar","min_height","max_height","setup","ed","on","e","change","setContent","css","background","host","background-size","lastIndexOf","uploadPic","img","this","next","loader","label","tempImgInput","type","class","display","position","files","reader","FileReader","target","result","readAsDataURL","removeClass","addClass","updateProgress","oEvent","pct","Math","ceil","loaded","total","height","text","fileUploadReq","withCredentials","json","remove","upload","addEventListener","name","click","computProgress","percentComplete","GetCurrentDate","cdate","Date","month","getMonth","currentDate","getFullYear","getDate","document","ready","showNames","_this","resList","empty","geonames","length","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","done","geoname","value","listItem","listLink","geonameId","toponymName","countryName","err","accordion","tab","execCommand","keyup","transloader","targetUrl","uploadType","html","show","hide","initUploadOf"],"mappings":"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","file":"root.babeled.min.js","sourcesContent":["'use strict';\n\n$(document).ready(function () {\n    $('.ui.accordion').accordion();\n    $('.ui.menu .item').tab();\n    initMce('#input-body');\n    $('a.item.edit-page').click(function () {\n        initMce('#mce-input' + $(this).data('tab'));\n    });\n    $('#btn-img').click(function () {\n        var tempImgInput = $('<input>').attr({\n            'type': 'file',\n            'class': 'temp-input'\n        }).css({\n            'display': 'none',\n            'position': 'absolute'\n        }).change(function () {\n            if (this.files && this.files[0]) {\n                var reader = new FileReader();\n                reader.onload = function (e) {\n                    tinymce.activeEditor.execCommand('insertHTML', false, '<img class=\"inline-img\" src=\"' + e.target.result + '\" width=\"100%\" >');\n\n                    tinymce.activeEditor.uploadImages();\n                };\n                reader.readAsDataURL(this.files[0]);\n            }\n\n            $('.temp-input').remove();\n        });\n        $('body').append(tempImgInput);\n        tempImgInput.click();\n    });\n    var editPages = [{}, {}, {}, { title: '关于信豚', name: 'about' }, { title: '商业合作', name: 'cooperation' }, { title: '招贤纳士', name: 'career' }, { title: '联系我们', name: 'contact' }];\n    ///////geonames\n    function showNames() {\n        var _this = this;\n        var resList = $(_this).next('.result');\n        $.get('http://api.geonames.org/searchJSON?lang=ZH&username=zhouzoro&maxRows=10&q=' + $(_this).val(), function (res) {\n            resList.empty();\n            if (res.geonames.length === 0) {\n                resList.append('No Results Found');\n            }\n            var _iteratorNormalCompletion = true;\n            var _didIteratorError = false;\n            var _iteratorError = undefined;\n\n            try {\n                for (var _iterator = res.geonames[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                    var geoname = _step.value;\n\n                    var listItem = $('<li>').attr('class', 'geoname-resultlist-item');\n                    var listLink = $('<a>').attr('data-id', geoname.geonameId).append($('<span>').attr('class', 'name').text(geoname.name)).append($('<span>').attr('class', 'toponymName').text('(' + geoname.toponymName + ')'));\n                    if (geoname.countryName && geoname.countryName !== '') {\n                        listLink.append($('<span>').attr('class', 'countryName').text(', ' + geoname.countryName)).append($('<span>').attr('class', 'toponymName').text('(' + geoname.toponymName + ')'));\n                    }\n                    resList.append(listItem.append(listLink));\n                }\n            } catch (err) {\n                _didIteratorError = true;\n                _iteratorError = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion && _iterator.return) {\n                        _iterator.return();\n                    }\n                } finally {\n                    if (_didIteratorError) {\n                        throw _iteratorError;\n                    }\n                }\n            }\n        });\n    }\n    $('.geosearch').keyup(showNames).change(showNames);\n});\n\nfunction login() {\n\n    var formData = new FormData($('form#login')[0]);\n    xhr.send(formData);\n}\n\nfunction updatePage(el) {\n    var $form = $($(el).data('form'));\n    tinymce.activeEditor.uploadImages(function (success) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('POST', '/cruiser_reports');\n\n        xhr.onload = function () {\n            var res = JSON.parse(xhr.responseText);\n            if (res.status == '200') {\n                showTipMsg('更新' + $form.find('input[name=type]') + '成功', 1);\n            } else if (res.status == '504') {\n                showTipMsg('更新失败: ' + res.msg, 0);\n            }\n        };\n\n        var contentHtml = tinymce.activeEditor.save();\n        var formData = new FormData($form[0]);\n        formData.append('html', contentHtml);\n        xhr.send(formData);\n    });\n}\n\nfunction uploadPost(formSelector) {\n    var $form = $(formSelector);\n\n    tinymce.activeEditor.uploadImages(function (success) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('POST', '/news');\n\n        xhr.onload = function () {\n            var res = JSON.parse(xhr.responseText);\n            if (res.status == '200') {\n                window.location = res.url;\n            } else if (res.status == '504') {\n                showTipMsg('上传失败: ' + res.msg, 0);\n            }\n        };\n\n        var contentHtml = tinymce.activeEditor.save();\n        $form.find('input[name=content]').val(contentHtml);\n        var formData = new FormData($form[0]);\n        xhr.send(formData);\n    });\n}\n\nfunction updatePost(formId) {\n    tinymce.activeEditor.uploadImages(function (success) {\n        var form = $(formId);\n        var xhr = new XMLHttpRequest();\n        xhr.open(form.attr('method'), form.attr('action'));\n\n        xhr.onload = function () {\n            console.log(xhr.responseText);\n            var res = JSON.parse(xhr.responseText);\n            if (res.status == '200') {\n                window.location = res.url;\n            } else if (res.status == '504') {\n                showTipMsg('上传失败: ' + res.msg, 0);\n            }\n        };\n        var contentHtml = tinymce.activeEditor.save();\n        $('input[name=content]').val(contentHtml);\n        var formData = new FormData(form[0]);\n        formData.append('username', Cookies.get('username'));\n        formData.append('email', Cookies.get('email'));\n        xhr.send(formData);\n    });\n}\n\nfunction initMce(selector, docId) {\n    var inline = docId ? true : false;\n    tinymce.init({\n        selector: selector,\n        skin: 'mxc1',\n        language: 'zh_CN',\n        content_css: '/stylesheets/dist/travelogue.min.css',\n        body_class: 'travelogue',\n        //inline: inline,\n        plugins: [\"autoresize\", \"advlist\", \"autolink\", \"lists\", \"link\", \"image\", \"charmap\", \"print\", \"preview\", \"anchor\", \"searchreplace\", \"visualblocks\", \"code\", \"fullscreen\", \"insertdatetime\", \"media\", \"table\", \"paste\", \"imagetools\"],\n        // plugins: 'table autoresize paste image imagetools preview',\n        /*style_formats: [{ title: 'H1', block: 'h1' }, { title: 'H2', block: 'h2' }, { title: 'H3', block: 'h3' }, { title: 'Bold text', inline: 'strong' }, { title: 'Red text', inline: 'span', styles: { color: '#ff0000' } }, { title: 'Red header', block: 'h1', styles: { color: '#ff0000' } }, { title: 'Badge', inline: 'span', styles: { display: 'inline-block', border: '1px solid #2276d2', 'border-radius': '5px', padding: '2px 5px', margin: '0 2px', color: '#2276d2' } }, { title: 'Table row 1', selector: 'tr', classes: 'tablerow1' }],\r\n        formats: {\r\n            alignleft: { selector: 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img', classes: 'left' },\r\n            aligncenter: { selector: 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img', classes: 'center' },\r\n            alignright: { selector: 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img', classes: 'right' },\r\n            alignfull: { selector: 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img', classes: 'full' },\r\n            bold: { inline: 'span', 'classes': 'bold' },\r\n            italic: { inline: 'span', 'classes': 'italic' },\r\n            underline: { inline: 'span', 'classes': 'underline', exact: true },\r\n            strikethrough: { inline: 'del' },\r\n            customformat: { inline: 'span', styles: { color: '#00ff00', fontSize: '20px' }, attributes: { title: 'My custom format' }, classes: 'example1' }\r\n        },*/\n        //content_css: '/stylesheets/person.min.css',\n        //plugins: \"advlist lists link anchor contextmenu paste image autoresize preview imagetools lists\",\n        toolbar: 'undo redo styleselect fontsizeselect bold italic underline alignleft aligncenter alignright alignfull advlist lists link',\n        image_caption: true,\n        paste_data_images: true,\n        //block_formats: 'Paragraph=p;Header 1=h1;Header 2=h2;Header 3=h3',\n        fontsize_formats: '8pt 9pt 10pt 11pt 12pt 14pt 18pt 24pt',\n        //plugins: \"contextmenu\",\n        //contextmenu: \"formatselect bold italic link image inserttable | cell row column deletetable\",\n        menubar: false,\n        images_upload_url: '/upload/images',\n        statusbar: false,\n        min_height: 480,\n        max_height: 640,\n\n        setup: function setup(ed) {\n            ed.on('change', function (e) {\n                var contentHtml = ed.save();\n                $('input[name=content]').val(contentHtml).change();\n            });\n            ed.on('init', function (e) {\n\n                if ($('input[name=content]').val()) {\n                    tinymce.activeEditor.setContent($('input[name=content]').val());\n                }\n\n                if ($('input[name=cover]').val()) {\n                    $('.post-hero').css({ 'background': 'url(\"http://' + window.location.host + $('input[name=cover]').val() + '\")', 'background-size': 'cover' });\n                }\n                if (!window.location.host.lastIndexOf('edit')) {}\n            });\n        }\n    });\n}\n\n$('.add-btn').click(function () {\n    var transloader = $('<div>').attr('class', 'expand-transition');\n    $(this).append(transloader);\n    var targetUrl = $(this).data('url');\n    var uploadType = $(this).data('type');\n    $.get(targetUrl, function (res) {\n        $('#modal-cust').find('.container').html(res);\n        $('#btn-cancel').click(function () {\n            $('#body').show();\n            $('#modal-cust').hide('fast');\n            $('#modal-cust').find('.container').html('');\n        });\n        $('#modal-cust').show('slow');\n        $('#body').hide('slow');\n        initUploadOf(uploadType);\n        transloader.remove();\n        $('#edit-pic').click(uploadPic);\n    });\n});\n\nfunction uploadPic() {\n    var img = $(this).next('img');\n    var loader = $(this).find('#pic-loader');\n    var label = $(this).find('label');\n    var tempImgInput = $('<input>').attr({\n        'type': 'file',\n        'class': 'temp-input'\n    }).css({\n        'display': 'none',\n        'position': 'absolute'\n    }).change(function () {\n        if (this.files && this.files[0]) {\n            var reader = new FileReader();\n            reader.onload = function (e) {\n                img.attr('src', e.target.result);\n            };\n            reader.readAsDataURL(this.files[0]);\n            label.removeClass('btn').addClass('pct');\n            var updateProgress = function updateProgress(oEvent) {\n                var pct = Math.ceil(100 * oEvent.loaded / oEvent.total);\n                var height = 100 - pct;\n                loader.css({ 'height': height + 'px' });\n                label.text(pct + '%');\n            };\n            var fileUploadReq = new XMLHttpRequest();\n            fileUploadReq.withCredentials = false;\n            fileUploadReq.open('POST', '/images');\n\n            fileUploadReq.onload = function () {\n                var json = JSON.parse(fileUploadReq.responseText);\n                console.log(json.location);\n                img.attr('src', json.location);\n                label.removeClass('pct').addClass('btn').text('change');\n                $('.temp-input').remove();\n            };\n            fileUploadReq.upload.addEventListener(\"progress\", updateProgress, false);\n            var formData = new FormData();\n            formData.append('image', this.files[0], this.files[0].name);\n            fileUploadReq.send(formData);\n        }\n    });\n    $('body').append(tempImgInput);\n    tempImgInput.click();\n}\n\nfunction computProgress(oEvent) {\n    var percentComplete = Math.ceil(1000 * oEvent.loaded / oEvent.total) / 10 + '%';\n    return percentComplete;\n}\n\nfunction GetCurrentDate() {\n    var cdate = new Date();\n    var month = cdate.getMonth() < 9 ? '0' + (cdate.getMonth() + 1) : cdate.getMonth() + 1;\n    var currentDate = cdate.getFullYear() + \"-\" + month + \"-\" + cdate.getDate();\n    return currentDate;\n}","$(document).ready(() => {\r\n    $('.ui.accordion').accordion();\r\n    $('.ui.menu .item').tab();\r\n    initMce('#input-body');\r\n    $('a.item.edit-page').click(function() {\r\n        initMce('#mce-input' + $(this).data('tab'));\r\n    })\r\n    $('#btn-img').click(function() {\r\n        var tempImgInput = $('<input>').attr({\r\n            'type': 'file',\r\n            'class': 'temp-input'\r\n        }).css({\r\n            'display': 'none',\r\n            'position': 'absolute'\r\n        }).change(function() {\r\n            if (this.files && this.files[0]) {\r\n                var reader = new FileReader();\r\n                reader.onload = function(e) {\r\n                    tinymce.activeEditor.execCommand('insertHTML', false, '<img class=\"inline-img\" src=\"' + e.target.result + '\" width=\"100%\" >');\r\n\r\n                    tinymce.activeEditor.uploadImages();\r\n                };\r\n                reader.readAsDataURL(this.files[0]);\r\n            }\r\n\r\n            $('.temp-input').remove();\r\n        });\r\n        $('body').append(tempImgInput);\r\n        tempImgInput.click();\r\n\r\n    });\r\n    var editPages = [{}, {}, {}, { title: '关于信豚', name: 'about' }, { title: '商业合作', name: 'cooperation' }, { title: '招贤纳士', name: 'career' }, { title: '联系我们', name: 'contact' }]\r\n        ///////geonames\r\n    function showNames() {\r\n        var _this = this;\r\n        var resList = $(_this).next('.result');\r\n        $.get('http://api.geonames.org/searchJSON?lang=ZH&username=zhouzoro&maxRows=10&q=' + $(_this).val(), function(res) {\r\n            resList.empty();\r\n            if (res.geonames.length === 0) {\r\n                resList.append('No Results Found');\r\n            }\r\n            for (let geoname of res.geonames) {\r\n                var listItem = $('<li>').attr('class', 'geoname-resultlist-item');\r\n                var listLink = $('<a>').attr('data-id', geoname.geonameId).append($('<span>').attr('class', 'name').text(geoname.name)).append($('<span>').attr('class', 'toponymName').text('(' + geoname.toponymName + ')'));\r\n                if (geoname.countryName && geoname.countryName !== '') {\r\n                    listLink.append($('<span>').attr('class', 'countryName').text(', ' + geoname.countryName)).append($('<span>').attr('class', 'toponymName').text('(' + geoname.toponymName + ')'));\r\n                }\r\n                resList.append(listItem.append(listLink));\r\n            }\r\n        })\r\n\r\n    }\r\n    $('.geosearch').keyup(showNames).change(showNames);\r\n});\r\n\r\nfunction login() {\r\n\r\n\r\n    var formData = new FormData($('form#login')[0]);\r\n    xhr.send(formData);\r\n}\r\n\r\nfunction updatePage(el) {\r\n    var $form = $($(el).data('form'));\r\n    tinymce.activeEditor.uploadImages(function(success) {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open('POST', '/cruiser_reports');\r\n\r\n        xhr.onload = function() {\r\n            var res = JSON.parse(xhr.responseText);\r\n            if (res.status == '200') {\r\n                showTipMsg('更新'+$form.find('input[name=type]')+'成功',1);\r\n            } else if (res.status == '504') {\r\n                showTipMsg('更新失败: ' + res.msg, 0);\r\n            }\r\n        };\r\n\r\n        var contentHtml = tinymce.activeEditor.save();\r\n        var formData = new FormData($form[0]);\r\n        formData.append('html', contentHtml);\r\n        xhr.send(formData);\r\n    });\r\n}\r\n\r\nfunction uploadPost(formSelector) {\r\n    var $form = $(formSelector);\r\n\r\n    tinymce.activeEditor.uploadImages(function(success) {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open('POST', '/news');\r\n\r\n        xhr.onload = function() {\r\n            var res = JSON.parse(xhr.responseText);\r\n            if (res.status == '200') {\r\n                window.location = res.url;\r\n            } else if (res.status == '504') {\r\n                showTipMsg('上传失败: ' + res.msg, 0);\r\n            }\r\n        };\r\n\r\n        var contentHtml = tinymce.activeEditor.save();\r\n        $form.find('input[name=content]').val(contentHtml);\r\n        var formData = new FormData($form[0]);\r\n        xhr.send(formData);\r\n    });\r\n}\r\n\r\nfunction updatePost(formId) {\r\n    tinymce.activeEditor.uploadImages(function(success) {\r\n        var form = $(formId);\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(form.attr('method'), form.attr('action'));\r\n\r\n        xhr.onload = function() {\r\n            console.log(xhr.responseText);\r\n            var res = JSON.parse(xhr.responseText);\r\n            if (res.status == '200') {\r\n                window.location = res.url;\r\n            } else if (res.status == '504') {\r\n                showTipMsg('上传失败: ' + res.msg, 0);\r\n            }\r\n        };\r\n        var contentHtml = tinymce.activeEditor.save();\r\n        $('input[name=content]').val(contentHtml);\r\n        var formData = new FormData(form[0]);\r\n        formData.append('username', Cookies.get('username'));\r\n        formData.append('email', Cookies.get('email'));\r\n        xhr.send(formData);\r\n    });\r\n}\r\n\r\nfunction initMce(selector, docId) {\r\n    var inline = docId ? true : false;\r\n    tinymce.init({\r\n        selector: selector,\r\n        skin: 'mxc1',\r\n        language: 'zh_CN',\r\n        content_css: '/stylesheets/dist/travelogue.min.css',\r\n        body_class: 'travelogue',\r\n        //inline: inline,\r\n        plugins: [\"autoresize\", \"advlist\", \"autolink\", \"lists\", \"link\", \"image\", \"charmap\", \"print\", \"preview\", \"anchor\", \"searchreplace\", \"visualblocks\", \"code\", \"fullscreen\", \"insertdatetime\", \"media\", \"table\", \"paste\", \"imagetools\"],\r\n        // plugins: 'table autoresize paste image imagetools preview',\r\n        /*style_formats: [{ title: 'H1', block: 'h1' }, { title: 'H2', block: 'h2' }, { title: 'H3', block: 'h3' }, { title: 'Bold text', inline: 'strong' }, { title: 'Red text', inline: 'span', styles: { color: '#ff0000' } }, { title: 'Red header', block: 'h1', styles: { color: '#ff0000' } }, { title: 'Badge', inline: 'span', styles: { display: 'inline-block', border: '1px solid #2276d2', 'border-radius': '5px', padding: '2px 5px', margin: '0 2px', color: '#2276d2' } }, { title: 'Table row 1', selector: 'tr', classes: 'tablerow1' }],\r\n        formats: {\r\n            alignleft: { selector: 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img', classes: 'left' },\r\n            aligncenter: { selector: 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img', classes: 'center' },\r\n            alignright: { selector: 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img', classes: 'right' },\r\n            alignfull: { selector: 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img', classes: 'full' },\r\n            bold: { inline: 'span', 'classes': 'bold' },\r\n            italic: { inline: 'span', 'classes': 'italic' },\r\n            underline: { inline: 'span', 'classes': 'underline', exact: true },\r\n            strikethrough: { inline: 'del' },\r\n            customformat: { inline: 'span', styles: { color: '#00ff00', fontSize: '20px' }, attributes: { title: 'My custom format' }, classes: 'example1' }\r\n        },*/\r\n        //content_css: '/stylesheets/person.min.css',\r\n        //plugins: \"advlist lists link anchor contextmenu paste image autoresize preview imagetools lists\",\r\n        toolbar: 'undo redo styleselect fontsizeselect bold italic underline alignleft aligncenter alignright alignfull advlist lists link',\r\n        image_caption: true,\r\n        paste_data_images: true,\r\n        //block_formats: 'Paragraph=p;Header 1=h1;Header 2=h2;Header 3=h3',\r\n        fontsize_formats: '8pt 9pt 10pt 11pt 12pt 14pt 18pt 24pt',\r\n        //plugins: \"contextmenu\",\r\n        //contextmenu: \"formatselect bold italic link image inserttable | cell row column deletetable\",\r\n        menubar: false,\r\n        images_upload_url: '/upload/images',\r\n        statusbar: false,\r\n        min_height: 480,\r\n        max_height: 640,\r\n\r\n        setup: function(ed) {\r\n            ed.on('change', function(e) {\r\n                var contentHtml = ed.save();\r\n                $('input[name=content]').val(contentHtml).change();\r\n            });\r\n            ed.on('init', function(e) {\r\n\r\n                if ($('input[name=content]').val()) {\r\n                    tinymce.activeEditor.setContent($('input[name=content]').val());\r\n                }\r\n\r\n                if ($('input[name=cover]').val()) {\r\n                    $('.post-hero').css({ 'background': 'url(\"http://' + window.location.host + $('input[name=cover]').val() + '\")', 'background-size': 'cover' });\r\n                }\r\n                if (!window.location.host.lastIndexOf('edit')) {}\r\n\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n$('.add-btn').click(function() {\r\n    var transloader = $('<div>').attr('class', 'expand-transition');\r\n    $(this).append(transloader);\r\n    var targetUrl = $(this).data('url');\r\n    var uploadType = $(this).data('type');\r\n    $.get(targetUrl, function(res) {\r\n        $('#modal-cust').find('.container').html(res);\r\n        $('#btn-cancel').click(function() {\r\n            $('#body').show();\r\n            $('#modal-cust').hide('fast');\r\n            $('#modal-cust').find('.container').html('');\r\n        });\r\n        $('#modal-cust').show('slow');\r\n        $('#body').hide('slow');\r\n        initUploadOf(uploadType);\r\n        transloader.remove();\r\n        $('#edit-pic').click(uploadPic);\r\n    });\r\n});\r\n\r\nfunction uploadPic() {\r\n    var img = $(this).next('img');\r\n    var loader = $(this).find('#pic-loader');\r\n    var label = $(this).find('label');\r\n    var tempImgInput = $('<input>').attr({\r\n        'type': 'file',\r\n        'class': 'temp-input'\r\n    }).css({\r\n        'display': 'none',\r\n        'position': 'absolute'\r\n    }).change(function() {\r\n        if (this.files && this.files[0]) {\r\n            var reader = new FileReader();\r\n            reader.onload = function(e) {\r\n                img.attr('src', e.target.result);\r\n            };\r\n            reader.readAsDataURL(this.files[0]);\r\n            label.removeClass('btn').addClass('pct');\r\n            var updateProgress = function updateProgress(oEvent) {\r\n                var pct = Math.ceil(100 * oEvent.loaded / oEvent.total);\r\n                var height = 100 - pct;\r\n                loader.css({ 'height': height + 'px' });\r\n                label.text(pct + '%');\r\n            };\r\n            var fileUploadReq = new XMLHttpRequest();\r\n            fileUploadReq.withCredentials = false;\r\n            fileUploadReq.open('POST', '/images');\r\n\r\n            fileUploadReq.onload = function() {\r\n                var json = JSON.parse(fileUploadReq.responseText);\r\n                console.log(json.location);\r\n                img.attr('src', json.location);\r\n                label.removeClass('pct').addClass('btn').text('change');\r\n                $('.temp-input').remove();\r\n            };\r\n            fileUploadReq.upload.addEventListener(\"progress\", updateProgress, false);\r\n            var formData = new FormData();\r\n            formData.append('image', this.files[0], this.files[0].name);\r\n            fileUploadReq.send(formData);\r\n        }\r\n    });\r\n    $('body').append(tempImgInput);\r\n    tempImgInput.click();\r\n}\r\n\r\n\r\nfunction computProgress(oEvent) {\r\n    var percentComplete = Math.ceil(1000 * oEvent.loaded / oEvent.total) / 10 + '%';\r\n    return percentComplete;\r\n}\r\n\r\nfunction GetCurrentDate() {\r\n    var cdate = new Date();\r\n    var month = cdate.getMonth() < 9 ? '0' + (cdate.getMonth() + 1) : cdate.getMonth() + 1;\r\n    var currentDate = cdate.getFullYear() + \"-\" + month + \"-\" + cdate.getDate();\r\n    return currentDate;\r\n}\r\n"],"sourceRoot":"/source/"}