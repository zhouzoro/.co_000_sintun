"use strict";function uploadImg(e){var a=$("<input>").attr({type:"file","class":"temp-input"}).css({display:"none",position:"absolute"}).change(function(){if(this.files&&this.files[0]){var a=new FileReader;a.onload=function(a){tinymce.get(e).insertContent('<img class="inline-img" src="'+a.target.result+'" width="100%" >'),tinymce.get(e).uploadImages(),$(".loader").removeClass("loading")},a.readAsDataURL(this.files[0]),$(".loader").addClass("loading")}$(".temp-input").remove()});$("body").append(a),a.click()}function login(){$(".loader").addClass("loading");var e=$("form#login"),a=new XMLHttpRequest;a.open(e.attr("method"),e.attr("action")),a.onload=function(){$(".loader").removeClass("loading");var e=JSON.parse(a.responseText);"504"==e.status?showTipMsg("登录失败: "+e.msg,0):(showTipMsg("登录成功: "+e.msg,1),$(".main").find(".login-page").hide(),$(".main").find("#control-panel").remove(),$(".main").append(e.html),$(".ui.accordion").accordion(),$(".ui.menu .item").tab(),$(".frm-body .input-body").each(function(){initMce("#"+$(this).attr("id"))}),$(window).scroll(function(){showScrollTop(),changeToolBarPosition()}),$(window).resize(changeToolBarPosition))};var t=new FormData(e[0]);a.send(t)}function updatePage(e){uploadPost(e)}function updatePass(){$(".loader").addClass("loading");var e=$("#frm-secu"),a=new XMLHttpRequest;a.open("POST","/update_pass"),a.onload=function(){var e=JSON.parse(a.responseText);"200"==e.status?window.location=e.url:"504"==e.status&&($(".loader").removeClass("loading"),showTipMsg("更新密码失败: "+e.msg,0))};var t=new FormData(e[0]);a.send(t)}function replaceImg(e){var a=$(e),t=a.parent(".ops"),n=t.prev("img"),i=$("<input>").attr({type:"file","class":"temp-input"}).css({display:"none",position:"absolute"}).change(function(){if($(".loader").addClass("loading"),this.files&&this.files[0]){var e=new FileReader;e.onload=function(e){n.attr("src",e.target.result),"hb.jpg"==a.data("name")&&($("header").css("background",'url("/images/default-bg.jpg")'),$("header").css({background:'url("'+e.target.result+'")',"background-size":"cover"}))},e.readAsDataURL(this.files[0]);var t=new XMLHttpRequest;t.withCredentials=!1,t.open("POST",a.data("url")),t.onload=function(){$(".loader").removeClass("loading"),i.remove()};var o=new FormData;o.append("image",this.files[0],this.files[0].name),o.append("fname",a.data("name")),o.append("name",$("input[name=name]").val()),o.append("password",$("input[name=password]").val()),t.send(o)}});$("body").append(i),i.click()}function deleteImg(e){$(".loader").addClass("loading");var a=$(e);deleteWithId(a.data(url)),a.parent(".img-container").remove()}function deleteWithId(e){var a=$("form#login"),t=new XMLHttpRequest;t.open(a.attr("method"),e);var n=new FormData(a[0]);t.send(n)}function uploadPi(e){var a=$(e),t=$("<input>").attr({type:"file","class":"temp-input"}).css({display:"none",position:"absolute"}).change(function(){if($(".loader").addClass("loading"),this.files&&this.files[0]){var e=new XMLHttpRequest;e.withCredentials=!1,e.open("POST","/upload/images/products/"+a.data("pid")),e.onload=function(){var a=JSON.parse(e.responseText),n=$("<div>").attr("class","col-xs-3 col-sm-3 col-md-3 col-lg-3 img-container"),i=$("<div>").attr("class","img").append($("<img>").attr("src","/images/products/"+a.pid+"/"+a.fname)),o=$("<div>").attr("class","ops").append($("<a>").attr({"class":"red",href:"#","data-name":a.fname,"data-id":a.id,"data-url":"/delete_imgs/"+a.id,onclick:"deleteImg(this)"}).text("删除")).append($("<a>").attr({href:"#","data-name":a.fname,"data-url":"/upload/images/products/"+a.pid,onclick:"replaceImg(this)"}).text("替换")).append($("<a>").attr({href:"/images/products/"+a.pid+"/"+a.fname,download:a.fname}).text("下载"));$(".rearange.ps").append(n.append(i.append(o))),$(".loader").removeClass("loading"),t.remove()};var n=new FormData;n.append("image",this.files[0],this.files[0].name),n.append("name",$("input[name=name]").val()),n.append("password",$("input[name=password]").val()),e.send(n)}});$("body").append(t),t.click()}function uploadPost(e){$(".loader").addClass("loading");var a=$(e);tinymce.activeEditor.uploadImages(function(t){var n=new XMLHttpRequest;n.open(a.attr("method"),a.attr("action")),n.onload=function(){var a=JSON.parse(n.responseText);"200"==a.status?"#frm-product"===e?($("a.item.pimg-tab").click(),$(".loader").removeClass("loading")):window.location=a.url:"504"==a.status&&($(".loader").removeClass("loading"),showTipMsg("上传失败: "+a.msg,0))};var i=tinymce.activeEditor.save();a.find("input[name=content]").val(i);var o=new FormData(a[0]);n.send(o)})}function openInNewTab(e){console.log(1);var a=$("<a>").attr({href:e,"class":"hidden",target:"__blank"});$("body").append(a),a.click()}function deleteNews(e){var a=$("#it"+e);a.find("*").hide();var t=$("<a>").attr({"class":"revoke-delete",onclick:'undoDelete("#it'+e+'")'}).append($("<i>").attr("class","fa fa-undo")).append("<span>取消</span>");a.append(t).append('<span class="revoke-delete date">已删除</span>'),window.setTimeout(function(){a.find(".revoke-delete")[0]&&(a.remove(),deleteWithId("/delete_news/"+e))},2400)}function deleteProducts(e){var a=$("#pit"+e);a.find("*").hide();var t=$("<a>").attr({"class":"revoke-delete",onclick:'undoDelete("#pit'+e+'")'}).append($("<i>").attr("class","fa fa-undo")).append("<span>取消</span>");a.append(t).append('<span class="revoke-delete date">已删除</span>'),window.setTimeout(function(){a.find(".revoke-delete")[0]&&(a.remove(),deleteWithId("/delete_products/"+e))},2400)}function loadToT(e){$(".loader").addClass("loading"),$.get(e,function(e){$(".ui.tab.active").removeClass("active"),$(".ui.tab.temp").html(e).addClass("active"),$(".ui.tab.temp").find("form").each(function(){var e=$(this),a=e.find(".input-body");initMce("#"+a.attr("id"))})})}function undoDelete(e){var a=$(e);a.find(".revoke-delete").remove(),a.find("*").show()}function showTipMsg(e,a){var t=a?"green":"red";$("p.tip-message").text(e).css({background:a?"rgba(55,222,88,0.3)":"rgba(222,55,88,0.3)",color:t,border:"1px solid "+t})}function initMce(e){$(".loader").addClass("loading");var a=$(e).data("imgurl");a||(a="/upload/images"),tinymce.init({selector:e,skin:"mxc1",language:"zh_CN",content_css:"/stylesheets/dist/travelogue.min.css",body_class:"travelogue",plugins:["autoresize","advlist","autolink","lists","link","image","charmap","print","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","paste","imagetools"],toolbar:"undo redo styleselect fontsizeselect bold italic underline alignleft aligncenter alignright alignfull advlist lists link",image_caption:!0,paste_data_images:!0,fontsize_formats:"8pt 9pt 10pt 11pt 12pt 14pt 18pt 24pt",menubar:!1,relative_urls:!1,images_upload_url:a,statusbar:!1,min_height:480,max_height:640,setup:function(e){e.on("change",function(a){var t=e.save();$("input[name=content]").val(t).change()}),e.on("init",function(e){$(".loader").removeClass("loading")})}})}function newProduct(){$.get("/new_product",function(e){var a=$(".cust-modal");a.html(e.html),$(".menu.tab-product .item").tab(),initMce("#mce-product"),a.removeClass("out")})}function uploadPic(){var e=$(this).next("img"),a=$(this).find("#pic-loader"),t=$(this).find("label"),n=$("<input>").attr({type:"file","class":"temp-input"}).css({display:"none",position:"absolute"}).change(function(){if(this.files&&this.files[0]){var n=new FileReader;n.onload=function(a){e.attr("src",a.target.result)},n.readAsDataURL(this.files[0]),t.removeClass("btn").addClass("pct");var i=function(e){var n=Math.ceil(100*e.loaded/e.total),i=100-n;a.css({height:i+"px"}),t.text(n+"%")},o=new XMLHttpRequest;o.withCredentials=!1,o.open("POST","/images"),o.onload=function(){var a=JSON.parse(o.responseText);console.log(a.location),e.attr("src",a.location),t.removeClass("pct").addClass("btn").text("change"),$(".temp-input").remove()},o.upload.addEventListener("progress",i,!1);var s=new FormData;s.append("image",this.files[0],this.files[0].name),o.send(s)}});$("body").append(n),n.click()}function checkVisible(e,a){a=a||"visible";var t=$(window).height(),n=$(window).scrollTop(),i=$(e).offset().top,o=$(e).height();return"visible"===a?t+n>i&&i>n-o:"above"===a?t+n>i:void 0}function showScrollTop(){checkVisible($("#top-indicator"))?$("#scroll-top").removeClass("in").addClass("out"):$("#scroll-top").removeClass("out").addClass("in")}function changeToolBarPosition(){$(".bottom-indicator").each(function(){var e=$(this),a=$(this).prev(".ops");checkVisible(e)?a.removeClass("sticky"):a.addClass("sticky")})}function ScrollTop(){var e=$("html, body");e.stop().animate({scrollTop:0},"400")}
//# sourceMappingURL=D:/Documents/GitHub/.co_000_sintun/wwwroot/javascripts/maps/root.babeled.min.js.map
