"use strict";function uploadImg(t){var e=$("<input>").attr({type:"file","class":"temp-input"}).css({display:"none",position:"absolute"}).change(function(){if(this.files&&this.files[0]){var e=new FileReader;e.onload=function(e){tinymce.get(t).insertContent('<img class="inline-img" src="'+e.target.result+'" width="100%" >'),tinymce.get(t).uploadImages()},e.readAsDataURL(this.files[0])}$(".temp-input").remove()});$("body").append(e),e.click()}function login(){var t=$("form#login"),e=new XMLHttpRequest;e.open(t.attr("method"),t.attr("action")),e.onload=function(){var t=JSON.parse(e.responseText);"504"==t.status?showTipMsg("登录失败: "+t.msg,0):(showTipMsg("登录成功: "+t.msg,1),$(".main").find(".login-page").hide(),$(".main").append(t.html),$(".ui.accordion").accordion(),$(".ui.menu .item").tab(),$(".frm-body .input-body").each(function(){initMce("#"+$(this).attr("id"))}))};var n=new FormData(t[0]);e.send(n)}function updatePage(t){var e=$(t);tinymce.activeEditor.uploadImages(function(t){var n=new XMLHttpRequest;n.open("POST","/pages"),n.onload=function(){var t=JSON.parse(n.responseText);"200"==t.status?window.location=t.url:"504"==t.status&&showTipMsg("更新失败: "+t.msg,0)};var a=tinymce.activeEditor.save();e.find("input[name=content]").val(a);var i=new FormData(e[0]);console.log(a),n.send(i)})}function updatePass(){var t=$("#frm-secu"),e=new XMLHttpRequest;e.open("POST","/update_pass"),e.onload=function(){var t=JSON.parse(e.responseText);"200"==t.status?window.location=t.url:"504"==t.status&&showTipMsg("更新失败: "+t.msg,0)};var n=new FormData(t[0]);e.send(n)}function uploadPost(t){var e=$(t);tinymce.activeEditor.uploadImages(function(t){var n=new XMLHttpRequest;n.open("POST","/news"),n.onload=function(){var t=JSON.parse(n.responseText);"200"==t.status?window.location=t.url:"504"==t.status&&showTipMsg("上传失败: "+t.msg,0)};var a=tinymce.activeEditor.save();e.find("input[name=content]").val(a);var i=new FormData(e[0]);n.send(i)})}function deleteNews(t){var e=$("#it"+t);e.find("*").hide(),e.append('<a class="revoke-delete button ui basic gray small" onclick="undoDelete('+t+')"><i class="fa fa-undo"></i>取消</a><span class="revoke-delete date">已删除</span>'),window.setTimeout(function(){if(e.find(".revoke-delete")[0]){e.remove();var n=$("form#login"),a=new XMLHttpRequest;a.open(n.attr("method"),"/delete_news/"+t);var i=new FormData(n[0]);a.send(i)}},4e3)}function undoDelete(t){var e=$("#it"+t);e.find(".revoke-delete").remove(),e.find("*").show()}function updatePost(t){tinymce.activeEditor.uploadImages(function(e){var n=$(t),a=new XMLHttpRequest;a.open(n.attr("method"),n.attr("action")),a.onload=function(){console.log(a.responseText);var t=JSON.parse(a.responseText);"200"==t.status?window.location=t.url:"504"==t.status&&showTipMsg("上传失败: "+t.msg,0)};var i=tinymce.activeEditor.save();$("input[name=content]").val(i);var o=new FormData(n[0]);o.append("username",Cookies.get("username")),o.append("email",Cookies.get("email")),a.send(o)})}function showTipMsg(t,e){var n=e?"green":"red";$("p.tip-message").text(t).css({background:e?"rgba(55,222,88,0.3)":"rgba(222,55,88,0.3)",color:n,border:"1px solid "+n})}function initMce(t,e){tinymce.init({selector:t,skin:"mxc1",language:"zh_CN",content_css:"/stylesheets/dist/travelogue.min.css",body_class:"travelogue",plugins:["autoresize","advlist","autolink","lists","link","image","charmap","print","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","paste","imagetools"],toolbar:"undo redo styleselect fontsizeselect bold italic underline alignleft aligncenter alignright alignfull advlist lists link",image_caption:!0,paste_data_images:!0,fontsize_formats:"8pt 9pt 10pt 11pt 12pt 14pt 18pt 24pt",menubar:!1,relative_urls:!1,images_upload_url:"/upload/images",statusbar:!1,min_height:480,max_height:640,setup:function(t){t.on("change",function(e){var n=t.save();$("input[name=content]").val(n).change()}),t.on("init",function(t){$("input[name=content]").val()&&tinymce.activeEditor.setContent($("input[name=content]").val()),$("input[name=cover]").val()&&$(".post-hero").css({background:'url("http://'+window.location.host+$("input[name=cover]").val()+'")',"background-size":"cover"}),!window.location.host.lastIndexOf("edit")})}})}function uploadPic(){var t=$(this).next("img"),e=$(this).find("#pic-loader"),n=$(this).find("label"),a=$("<input>").attr({type:"file","class":"temp-input"}).css({display:"none",position:"absolute"}).change(function(){if(this.files&&this.files[0]){var a=new FileReader;a.onload=function(e){t.attr("src",e.target.result)},a.readAsDataURL(this.files[0]),n.removeClass("btn").addClass("pct");var i=function(t){var a=Math.ceil(100*t.loaded/t.total),i=100-a;e.css({height:i+"px"}),n.text(a+"%")},o=new XMLHttpRequest;o.withCredentials=!1,o.open("POST","/images"),o.onload=function(){var e=JSON.parse(o.responseText);console.log(e.location),t.attr("src",e.location),n.removeClass("pct").addClass("btn").text("change"),$(".temp-input").remove()},o.upload.addEventListener("progress",i,!1);var s=new FormData;s.append("image",this.files[0],this.files[0].name),o.send(s)}});$("body").append(a),a.click()}function computProgress(t){var e=Math.ceil(1e3*t.loaded/t.total)/10+"%";return e}function GetCurrentDate(){var t=new Date,e=t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getFullYear()+"-"+e+"-"+t.getDate();return n}$(document).ready(function(){$(".ui.accordion").accordion(),$(".ui.menu .item").tab()}),$(".add-btn").click(function(){var t=$("<div>").attr("class","expand-transition");$(this).append(t);var e=$(this).data("url"),n=$(this).data("type");$.get(e,function(e){$("#modal-cust").find(".container").html(e),$("#btn-cancel").click(function(){$("#body").show(),$("#modal-cust").hide("fast"),$("#modal-cust").find(".container").html("")}),$("#modal-cust").show("slow"),$("#body").hide("slow"),initUploadOf(n),t.remove(),$("#edit-pic").click(uploadPic)})});
//# sourceMappingURL=D:/Documents/GitHub/.co_000_sintun/wwwroot/javascripts/maps/root.babeled.min.js.map
